<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1"
      http-equiv="Content-Type">
    <title>Settings Window</title>
    <link type="text/css" rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>DiFX GUI System Settings Window</h1>
    The DiFX GUI System Settings window contains all user-editable
    parameters that control the configuration and appearance of the GUI,
    as well as its communication with the core DiFX software.&nbsp; The
    System Settings are organized in a browse-able hierarchy of
    "sub-topics" that can be opened and closed as needed.&nbsp;
    Sub-topics include:<br>
    <ul>
      <li>Settings File</li>
      <li><a href="#DiFX_Control_Connection">DiFX Control Connection</a><br>
      </li>
      <li><a href="#Broadcast_Network">Broadcast Network</a></li>
      <li><a href="#Database_Configuration">Database Configuration</a></li>
      <li>Documentation Locations</li>
    </ul>
    <h2><a name="DiFX_Control_Connection"></a>DiFX Control Connection</h2>
    The DiFX Control Connection setting determine how commands are sent
    to DiFX.&nbsp; Processing and data nodes should all be running <span
      style="font-style: italic;">mk5daemon</span> to send and receive
    XML messages (if the "Broadcast Monitor" light next to a node in the
    Hardware Monitor window is blinking green occasionally, then <span
      style="font-style: italic;">mk5daemon</span> is running on that
    node).&nbsp; Control commands that start, stop, and otherwise
    manipulate jobs are sent to the <span style="font-style: italic;">mk5daemon</span>
    running on one particular node (usually this is the "head node", but
    this is not a requirement).<br>
    <h4>Host</h4>
    This is the hostname of the node which is to receive DiFX control
    commands (job start, stop, etc).&nbsp; This node must be running <span
      style="font-style: italic;">mk5daemon</span>, obviously, for this
    to work.&nbsp; In addition, the "root" user on this node must be
    able to "ssh" to the DiFX user (see below) on each processing and
    data source node without typing a password or RSA key.&nbsp; If you
    are having trouble with RSA (we did), try the following.&nbsp; As
    "root" on the DiFX host, make sure you have an RSA key (in the file
    <span style="font-family: monospace;">.ssh/id_rsa.pub</span> in
    root's home directory).&nbsp; If you don't, create one with the
    following command (answer any questions by hitting "return"):<br>
    <pre>	ssh-keygen -t rsa</pre>
    You will have to log out and log back in for the new key to be
    active, or type:<br>
    <pre>	ssh-add</pre>
    Then type this for <span style="font-weight: bold;">every node</span>
    you are using, including the DiFX host itself.&nbsp; You should use
    complete addresses for machine names, not aliases (it is not
    entirely clear that this is a problem, but we had some issues with
    it):<br>
    <pre>	ssh-copy-id user@node<br></pre>
    For instance, if your DiFX user is "difx", your DiFX host is "king"
    and your other processing nodes and mark 5's are "pawn1", "pawn2",
    "mark5-1" and "mark5-2" you would need to do the following (as root
    on "king"):<br>
    <pre>	ssh-copy-id difx@king<br>	ssh-copy-id difx@pawn1<br>	ssh-copy-id difx@pawn2<br>	ssh-copy-id difx@mark5-1<br>	ssh-copy-id difx@mark5-2<br></pre>
    These commands must be run as "root" on the DiFX host node.&nbsp; It
    is important that you log in as root (i.e. not ssh!) because you
    want to guarantee that it is the root key that is being
    copied.&nbsp; Log completely out of the machine and log in as
    root!&nbsp; Trust us on this!<br>
    <br>
    To test whether this has worked, you should be able to "ssh" to your
    DiFX user on all nodes from root on the DiFX host node without
    entering a password or key.&nbsp; If you can't do this, things are
    not set up right and jobs will not run.<br>
    <br>
    These changes should survive reboots, as well as RSA key stuff ever
    does.<br>
    <h4>Port</h4>
    This is the broadcast port for control communications.&nbsp;
    Normally it is the same as the Port setting under Broadcast Network
    (default is currently 50200).<br>
    <h4>User<br>
    </h4>
    This is the DiFX user - the owner of all DiFX-related data files and
    directories.&nbsp; Normally this user is "difx" but this is not a
    requirement.<br>
    <h4>Password</h4>
    The password for the DiFX user.<br>
    <h4>DiFX Version</h4>
    The DiFX Version is passed to <span style="font-style: italic;">mk5daemon</span>
    when running a correlator job.&nbsp; It should match the version of
    DiFX being run on the head node.&nbsp; <span style="font-style:
      italic;">Don't worry too much about this field - currently it does
      nothing!</span><br>
    <h4>DiFX Path</h4>
    <p>The DiFX Path field allows you to set the path <span
        style="font-style: italic;">mk5daemon</span> will follow when
      running DiFX executables (specifically <span style="font-style:
        italic;">vex2difx </span>and <span style="font-style: italic;">mpirun</span>)
      - it points to the top level of your DiFX software tree on your
      DiFX host (e.g. "<span style="font-family: monospace;">/usr/local/difx</span>"
      or something similar).&nbsp; Using this field you can easily
      switch your processing between different versions of DiFX
      software, if, for instance, you want to test an upgrade of the
      software.&nbsp; For normal operation you can leave this field
      blank, in which case <span style="font-style: italic;">mk5daemon</span>
      will use the environment variable <span style="font-family:
        monospace;">DIFX_PREFIX</span> to determine the path.<br>
    </p>
    <h2><a name="Broadcast_Network"></a>Broadcast Network</h2>
    The broadcast network is used by DiFX processes to communicate with
    each other.&nbsp; It is used by the user interface <span
      style="font-style: italic;"></span>to communicate with <span
      style="font-style: italic;">mk5daemon</span> and thus control the
    software correlator.&nbsp; It is also used by <span
      style="font-style: italic;">mk5daemon</span> instances running on
    all processing and data source nodes to communicate their status and
    the state of running jobs.&nbsp; The broadcast network is based on
    UDP, and will only work within a local area network.<br>
    <h4>Group IP Address</h4>
    This address is used to identify the "group" of UDP broadcasts that
    <span style="font-style: italic;">mk5daemon</span> is using.&nbsp;
    It should match the DIFX_MESSAGE_GROUP environment variable setting
    used when starting <span style="font-style: italic;">mk5daemon</span>
    on all processing and data source nodes (run <span
      style="font-style: italic;">mk5daemon</span> with the "-h" option
    for details).&nbsp; At the moment the default value for this
    environment variable, and thus the setting you should probably use
    here, is "224.2.2.1".<br>
    <h4>Port</h4>
    The port is used for UDP broadcasts.&nbsp; This should match the
    value of the DIFX_MESSAGE_PORT environment variable in place when <span
      style="font-style: italic;">mk5daemon</span> was started.&nbsp; At
    the moment the default value for the environment variable, and thus
    this field, is 50200.<br>
    <h4>Buffer Size</h4>
    This is the maximum size of a broadcast message, in bytes.&nbsp;
    Probably this shouldn't be fiddled with too much - making it too
    small will cause UDP messages to be incompletely read.&nbsp; It is a
    block of memory that must be allocated for each incoming message, so
    it shouldn't be huge either.&nbsp; <br>
    <h4>Timeout (ms)</h4>
    The timeout is the number of milliseconds that the system will wait
    for an incoming broadcast message.&nbsp; It can be set to 0, which
    means "wait forever", although this might be unhealthy (killing the
    thread that reads messages will become difficult).&nbsp; Otherwise
    it does little more than govern the update rate of the Packet
    Traffic Plot (see below).<br>
    <h4>Packet Traffic Plot</h4>
    The Packet Traffic Plot shows all received UDP messages as they are
    read in real time.&nbsp; If you are receiving messages (i.e. all of
    the above settings are set properly) this should have a heartbeat
    appearance - there should be occasional spikes as messages come in
    (the height of the spikes is the size of messages relative to the
    Buffer Size).&nbsp; If, on the other hand, you get a "flat line",
    your settings are wrong, or <span style="font-style: italic;">mk5daemon</span>
    isn't running anywhere visible on the local area network.<br>
    <br>
    Below is a "healthy" Packet Traffic Plot showing a series of UDP
    messages over time:<br>
    <img style=" width: 302px; height: 124px;" alt=""
      src="images/settings/good_packet_traffic_plot.gif"><br>
    <ul>
    </ul>
    <h2><a name="Database_Configuration"></a>Database Configuration</h2>
    Trouble?&nbsp; See <a href="#Testing_the_Database_Configuration"><span
        style="font-style: italic;">Trouble-shooting the Database
        Configuration</span></a>.<br>
    <br>
    The Database Configuration settings control the access the GUI has
    to the DiFX database on the DiFX host.&nbsp; The DiFX database
    contains settings and status for all queued experiments, passes, and
    jobs that appear in the Queue Browser window.&nbsp; It is a mySQL
    database that allows remote access via a network connection (it can
    also be consulted directly by running a mySQL client program on the
    DiFX host).&nbsp; The following fields govern remote access to the
    database:<br>
    <h4>Use Data Base</h4>
    This checkbox determines whether the GUI is using the database at
    all.&nbsp; If checked, changes to experiments, passes, and jobs in
    the Queue Browser will be reflected in the database, and items in
    the database will appear in the Queue Browser.&nbsp; If not,
    experiments, passes, and jobs in the Queue Browser will be saved
    "locally", and information about them may be lost if the GUI is shut
    down.&nbsp; However the GUI will still be able to run DiFX.<br>
    <h4>Version</h4>
    <p>The version field is not currently in use, but may be used in the
      future to coordinate the GUI with changes that may be made to the
      database structure.&nbsp; At the moment it is set to blank or
      "unknown" by default.&nbsp; Changing it will have no effect on
      anything.<br>
    </p>
    <h4>Host</h4>
    The database Host is the hostname of the DiFX host that contains the
    DiFX database.&nbsp; The named host should be accessible through
    normal network connections, and the hostname itself must be
    recognized by the name lookup scheme on the GUI machine.&nbsp; The <a
      href="#Database_Ping_Test">ping test</a> can be used to test the
    hostname.<br>
    <h4>User</h4>
    The User is mySQL username for the DiFX database.&nbsp; This is the
    name you would use when running the mySQL client on the DiFX host as
    follows:<br>
    <pre>mysql -u USER<br></pre>
    It does not necessarily match the username you may use to log into
    the DiFX host.&nbsp; The mySQL database must be set up to recognize
    this user, <span style="font-style: italic;">including access to
      the database from the host where the DiFX GUI is running</span>.&nbsp;

















    See <a href="#Database_Remote_Access">Problems with Database Remote
      Access</a> in the trouble-shooting section for details.<br>
    <h4>Password</h4>
    This is the password for the username in the mySQL database.&nbsp;
    This is the password you would use when prompted by the mySQL client
    on the DiFX host.&nbsp; This password is set by the mySQL
    administrator or by the user through the mySQL client.&nbsp; It is
    not necessarily the same password you would use to log into the DiFX
    host.<br>
    <span style="font-weight: bold;"><span style="font-weight: bold;"></span></span>
    <h4>DifX Database</h4>
    The DifX Database is the name of the database that contains the DiFX
    queue.&nbsp; At the time of this writing the rest of the DiFX
    software (difxqueue, etc) uses the database named "difxdb", so that
    is the default value for this field.&nbsp; It probably shouldn't be
    changed.&nbsp; However it is easy to imagine a situation where
    different queues might have different names, so the option of
    changing the database has been included.&nbsp; The GUI software
    implements this option - if you change "difxdb" to something else,
    database access will probably break for the time being.<br>
    <h4>JDBC Driver</h4>
    This is the "driver" used by Java to give the GUI access to the
    mySQL database.&nbsp; It probably should not be changed (the field
    is included to ease transitions between other database software -
    Oracle, etc. - although there are other problems associated with
    changing database types).<br>
    <h4>JDBC Port</h4>
    The JDBC Port is the port over which remote communication with the
    mySQL database occurs.&nbsp; The default port for most mySQL
    installation is 3306, so that is probably what you should be setting
    yours to.&nbsp; Consult the <code>/etc/services</code> file on the
    DiFX host to find out which port is being used.<br>
    <h4>Periodic Update</h4>
    This checkbox tells the Queue Browser to automatically check the
    database for changes after a given time interval, which you can
    set.&nbsp; Checking the database isn't computationally expensive nor
    does it involve much network traffic, however the database probably
    doesn't change much so an interval of a few seconds should be fine.<br>
    <h2><a name="Testing_the_Database_Configuration"></a>Trouble-shooting

















      the Database Configuration</h2>
    A number of things can go wrong when trying to access the DiFX
    database remotely.&nbsp; The Database Configuration panel contains a
    few tests that can be used to troubleshoot the database connection.<br>
    <h3><a name="Database_Ping_Test"></a>Ping Test</h3>
    The Ping Test is run by hitting the "Ping Host" button.&nbsp; It can
    be used to establish two things:<br>
    <ol>
      <li>Can the name for the DiFX host be resolved - i.e. does the
        host name make any sense?</li>
      <li>Is the host reachable with the current network configuration -
        i.e. is it out there?</li>
    </ol>
    The Ping Test performs attempts six "pings" of the named host,
    reporting the results in the results panel.&nbsp; A successful ping
    test will return statistics for each of the pings along with an
    overall statistical summary:<br>
    <br>
    <img style=" width: 476px; height: 196px;" alt=""
      src="images/settings/good_ping_test.gif"><br>
    <br>
    Ping Test failures will produce alarming red text in the results
    panel.&nbsp; The reported failure should give you an idea what is
    wrong.&nbsp; For instance, the following indicates that the given
    hostname cannot be resolved, either by your local host table or by
    your name server:<br>
    <br>
    <img style=" width: 456px; height: 191px;" alt=""
      src="images/settings/bad_hostname_ping_test.gif"><br>
    <br>
    The following screen would indicate a bad network connection at the
    GUI machine:<br>
    <br>
    <img style=" width: 465px; height: 189px;" alt=""
      src="images/settings/bad_network_ping_test.gif"><br>
    <br>
    Finally, the name may be resolved and the network may be good but
    the named host may not answer either because it is down or it is not
    properly connected to the network:<br>
    <br>
    <img style=" width: 501px; height: 186px;" alt=""
      src="images/settings/lost_host_ping_test.gif"><br>
    <br>
    <h3>Database Connection Test</h3>
    The Database Connection Test makes a comprehensive test of the
    current database settings by trying to access the DiFX job queue and
    getting a list of all jobs out of it (this is exactly what the Queue
    Browser does to access the queue data).&nbsp; It is run using the
    "Test Database" button.&nbsp; When run, the test forms a URL out of
    host name and port number (this URL is reported in parenthesis in
    the results panel), then attempts to create a connection using the
    URL, the user, and the password.&nbsp; If this is successful, the
    DiFX database is consulted to obtain a list of all queued
    jobs.&nbsp; The Database Connection Test reports the number of jobs
    in the queue and exits.<br>
    <br>
    <img style=" width: 646px; height: 188px;" alt=""
      src="images/settings/good_database_test.gif"><br>
    <h3><a name="Database_Remote_Access"></a>Problems with Database
      Remote Access</h3>
    The following is a list of some of the errors that might be produced
    by the Database Connection Test and what can be done about
    them.&nbsp; Note that these errors may also be reported in the
    Message Window as the GUI tries to access the DiFX queue in the
    database.<br>
    <code></code> <code></code><code></code><code><br>
      <br>
      <br>
    </code>
    <div style="margin-left: 40px; font-weight: bold;">
      <h6><code>SQLException: Communications link failure The last
          packet sent successfully to the server was 0 milliseconds ago.
          The driver has not received any packets from the server.</code></h6>
    </div>
    <div style="margin-left: 40px;"><br>
    </div>
    This error indicates that the connection to the remote mySQL
    database failed.&nbsp; Check that the DiFX host exits and in on the
    network (using the <a href="#Database_Ping_Test">Ping Test</a>).&nbsp;













    Then remote log into that host and see if the mySQL server is
    runing:<br>
    <ul style="margin-left: 40px;">
    </ul>
    <pre style="margin-left: 40px;">ps -ef | grep mysql
</pre>
    Both <span style="font-style: italic;">mysql_safe</span> and <span
      style="font-style: italic;">mysqld</span> should be running.&nbsp;
    The latter is the mySQL server, the former is used to start it
    when/if it shuts down.&nbsp; In a proper installation of mySQL these
    programs should be running automatically after boot up.&nbsp; If
    they ARE running, see if a mySQL client can be run (the path may be
    different):<span style="font-family: monospace;"><br>
    </span>
    <div style="margin-left: 40px;">
      <pre><span style="font-family: monospace;"></span>/usr/bin/mysql</pre>
    </div>
    If it cannot be run, this may indicate an incorrect or incomplete
    mySQL installation.<br>
    <br>
    <br>
    <div style="margin-left: 40px; font-weight: bold;">
      <h6><code>SQLException: Access denied for user 'difxw'@'10.1.2.45'
          (using password: YES)</code></h6>
      <h6><code></code></h6>
      <code><br>
      </code></div>
    Access to the database can be denied for a number of reasons.&nbsp;
    Check your user name and password (these need to be mySQL user name
    and password, not necessarily the user name and password you use to
    remotely log into the DiFX host).&nbsp; If you can, run the mySQL
    client on the DiFX host as root from the command line (you will
    require the root password):<br>
    <pre style="margin-left: 40px;">/usr/bin/mysql -u root -p</pre>
    Then generate a list of all users and hosts recognized by mySQL:<br>
    <pre style="margin-left: 40px;">mysql&gt; select user, host from mysql.user;</pre>
    <pre style="margin-left: 40px;">+------+---------------------+<br>| user | host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>+------+---------------------+<br>| difx | 10.1.2.45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| difx | 127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| root | 127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| difx | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| root | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | swc02.usno.navy.mil |<br>| difx | swc02.usno.navy.mil |<br>| root | swc02.usno.navy.mil |<br>+------+---------------------+<br>9 rows in set (0.00 sec)</pre>
    In this list somewhere should be the user name you are using paired
    with the GUI host name.&nbsp; Note that mySQL treats user/host pairs
    almost as separate users - you must designate both your user name
    and host as a "user".&nbsp; To do this, the following command will
    both "create" the user/host pair and give it access to all databases
    (note that "grant" is a complex command used for many things - you
    should consult mySQL documentation before using this command with
    reckless abandon):<br>
    <pre style="margin-left: 40px;">mysql&gt; grant all privileges on *.* to 'difx'@'new.host.name';<br>Query OK, 0 rows affected (0.00 sec)</pre>
    You should then see the user/host pair in the user list:<br>
    <pre style="margin-left: 40px;">mysql&gt; select user, host from mysql.user;<br><br>+------+---------------------+<br>| user | host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>+------+---------------------+<br>| difx | 10.1.2.45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| difx | 127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| root | 127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| difx | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| root | localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br>| difx | new.host.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |   &lt;---------------- HERE!!!!<br>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | swc02.usno.navy.mil |<br>| difx | swc02.usno.navy.mil |<br>| root | swc02.usno.navy.mil |<br>+------+---------------------+<br>10 rows in set (0.00 sec)</pre>
    The user/host pair needs its own password specification - even if
    your user name already had a password, this is not enough!&nbsp; To
    specifiy the password for the new user/host pair (or to make sure
    your password is set properly on an existing user/host pair), do the
    following (replaced "PASSWORD" with your new password):<br>
    <pre style="margin-left: 40px;">mysql&gt; set password for 'difx'@'new.host.name'=password( 'PASSWORD' );<br>Query OK, 0 rows affected (0.00 sec)</pre>
    At this point we reach the limits of my personal mySQL knowledge.<br>
    <br>
    <br>
    <h6> <span style="font-weight: bold; font-family: monospace;">&nbsp;&nbsp;&nbsp;
        Database contains 0 jobs.</span></h6>
    <br>
    This is not an error, however you may encounter this message.&nbsp;
    It simply means there are no jobs queued in the specified
    database.&nbsp; If this is not what you expect (because, for
    instance, you've recently queued something), check the value in the
    "DiFX Database" field.&nbsp; It should match your the name of the
    database where queuing is going on (which is probably "difxdb").<br>
    <br>
  </body>
</html>
